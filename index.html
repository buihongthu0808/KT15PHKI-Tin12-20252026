<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hành Trình Săn Kẹo Ngọt</title>
    
    <!-- Tải Tailwind CSS để trang trí giao diện -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tải Babel để trình duyệt hiểu được code React -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Khai báo nơi tải thư viện React và Icon (Import Map) -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <style>
        /* Hiệu ứng rung nhẹ cho kẹo */
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .animate-wiggle {
            animation: wiggle 1s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- Mã nguồn trò chơi -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Play, Lock, Check, X, Trophy, Clock, Heart, RotateCcw, 
          ArrowRight, Map as MapIcon, Home, Trees, Waves, Flame, 
          Candy, Skull, Footprints, Star, User, ChevronDown, 
          Volume2, Info, LogOut, School, Smile 
        } from 'lucide-react';

        /**
         * DỮ LIỆU HỌC SINH
         */
        const INITIAL_STUDENTS = {
          "12A1": [
            "Lương Duy Anh", "Nghiêm Tùng Anh", "Nguyễn Huỳnh Tài Đức Anh", "Nguyễn Ngọc Anh", "Nguyễn Việt Anh", 
            "Vũ Thị Minh Anh", "Nguyễn Tuấn Bình", "Nguyễn Tiến Dương", "Bùi Đình Đại", "Phạm Tiến Đạt", 
            "Phùng Tiến Đạt", "Phạm Hải Đăng", "Nguyễn Đỗ Hoàng Hà", "Nguyễn Thu Huế", "Phạm Nguyễn Duy Hưng", 
            "Lê Thị Diệu Hương", "Trần Hà Linh", "Bùi Quang Long", "Trịnh Hải Long", "Phạm Thành Lương", 
            "Phạm Xuân Mạnh", "Nguyễn Quang Minh", "Bùi Xuân Nam", "Phạm Khánh Ngọc", "Hoàng Lê Nguyên", 
            "Chu Nguyễn Phương Oanh", "Nguyễn Thị Thanh Phương", "Bùi Minh Quang", "Nguyễn Như Quỳnh", 
            "Trần Mỹ Tâm", "Nguyễn Chí Thanh", "Đỗ Xuân Thành", "Trịnh Huệ Thiên", "Nguyễn Việt Tiến", 
            "Nguyễn Ngọc Tuấn", "Trần Tuấn Tú"
          ],
          "12A7": [
            "Đặng Thị Quỳnh Anh", "Đinh Đỗ Lan Anh", "Lưu Việt Anh", "Nguyễn Phương Anh", "Nguyễn Trần Tùng Anh", 
            "Nguyễn Tuấn Anh", "Nguyễn Tùng Anh", "Trần Xuân Bắc", "Lê Thị Minh Chuyên", "Trần Thu Cúc", 
            "Bùi Thị Bích Diệp", "Hà Công Doanh", "Đỗ Mạnh Duy", "Nguyễn Tiến Duy", "Phạm Mạnh Dũng", 
            "Cao Hải Đăng", "Pham Minh Đức", "Nguyễn Minh Hiếu", "Trần Minh Hiếu", "Trần Mạnh Hùng", 
            "Trần Tuấn Hưng", "Trần Thùy Linh", "Trần Nhất Long", "Giang Xuân Lộc", "Nguyễn Quỳnh Mai", 
            "Bùi Đức Minh", "Phạm Thúy Nga", "Nguyễn Duy Nguyên", "Phạm Thị Yến Nhi", "Trân Thị Kim Như", 
            "Lưu Thị Mai Phương", "Kiều Như Thành", "Nguyễn Thị Phương Thảo", "Lại Thị Hồng Thuỷ", 
            "Trần Minh Thư", "Trần Minh Thư", "Đỗ Minh Tiến", "Đồng Thu Trang", "Lưu Thị Thu Trang", 
            "Nguyễn Quỳnh Trang", "Trân Thùy Trang", "Trần Văn Trọng", "Nguyễn Hoàng Thái Tuấn", 
            "Trân Thanh Tùng", "Trần Thị Hoài Vân", "Lại Thế Vinh"
          ]
        };

        /**
         * DỮ LIỆU CẤP ĐỘ
         */
        const DATA_LEVELS = [
          {
            id: 1,
            title: "Cấp 1: Kiến Thức HTML",
            description: "Các câu hỏi trắc nghiệm về thẻ HTML (40 điểm).",
            theme: "forest",
            icon: <Trees size={32} />,
            color: "bg-emerald-600",
            bgColor: "bg-emerald-50",
            accentColor: "text-emerald-700",
            timePerQuestion: 30, 
            type: "multiple-choice",
            questions: [
              { 
                q: "Phương án nào sau đây mô tả đúng chức năng của thẻ <mark> trong HTML?", 
                options: [
                  "Làm cho văn bản hiển thị in đậm", 
                  "Tô màu nền để đánh dấu văn bản quan trọng", 
                  "Hiển thị văn bản dưới dạng chữ gạch dưới", 
                  "Làm cho văn bản có hiệu ứng nhấp nháy"
                ], 
                correct: 1 
              },
              { 
                q: "Phương án nào sau đây không phải là một cách làm nổi bật văn bản trong HTML?", 
                options: [
                  "Sử dụng thẻ <strong> để làm đậm nội dung.", 
                  "Dùng thẻ <em> để làm nghiêng văn bản.", 
                  "Dùng thẻ <mark> để tô màu nền của văn bản.", 
                  "Dùng thẻ <p> để làm cho chữ in hoa."
                ], 
                correct: 3 
              },
              { 
                q: "Phát biểu nào sau đây mô tả đúng sự khác biệt giữa thẻ <em> và <i> trong HTML?", 
                options: [
                  "<em> chỉ thay đổi màu sắc chữ, còn <i> giúp nhấn mạnh nội dung văn bản", 
                  "<em> giúp nhấn mạnh ý nghĩa nội dung, còn <i> chỉ tạo hiệu ứng in nghiêng mà không mang ý nghĩa ngữ nghĩa", 
                  "<i> không còn được hỗ trợ trong HTML5, còn <em> có thể thay đổi kiểu chữ", 
                  "<em> chỉ có tác dụng làm đậm chữ, còn <i> giúp nội dung dễ đọc hơn"
                ], 
                correct: 1 
              },
              { 
                q: "Để giúp học sinh khiếm thị dễ dàng tiếp cận nội dung (screen reader), nhà phát triển nên sử dụng thẻ nào để đánh dấu các thuật ngữ quan trọng?", 
                options: [
                  "<i>Thuật ngữ quan trọng</i>", 
                  "<b>Thuật ngữ quan trọng</b>", 
                  "<em>Thuật ngữ quan trọng</em>", 
                  "<span>Thuật ngữ quan trọng</span>"
                ], 
                correct: 2 
              }
            ]
          },
          {
            id: 2,
            title: "Cấp 2: Liên Kết HTML",
            description: "Quyết định Đúng hoặc Sai về liên kết HTML (30 điểm).",
            theme: "ocean",
            icon: <Waves size={32} />,
            color: "bg-blue-600",
            bgColor: "bg-blue-50",
            accentColor: "text-blue-700",
            timePerQuestion: 20, 
            type: "multiple-choice",
            questions: [
              { 
                q: "Thuộc tính href của thẻ <a> dùng để chỉ định địa chỉ liên kết.", 
                options: ["Đúng", "Sai"], 
                correct: 0 
              },
              { 
                q: "Để mở liên kết trên chính tab hiện tại, cần thêm thuộc tính target=\"_blank\" vào thẻ <a>.", 
                options: ["Đúng", "Sai"], 
                correct: 1 
              },
              { 
                q: "Muốn chèn một hình ảnh làm siêu liên kết, có thể đặt thẻ <img> bên trong thẻ <a>.", 
                options: ["Đúng", "Sai"], 
                correct: 0 
              }
            ]
          },
          {
            id: 3,
            title: "Cấp 3: Ghép Nối Thẻ HTML",
            description: "Kéo thả để ghép thẻ với chức năng tương ứng (30 điểm).",
            theme: "volcano",
            icon: <Flame size={32} />,
            color: "bg-rose-600",
            bgColor: "bg-rose-50",
            accentColor: "text-rose-700",
            timePerQuestion: 15,
            type: "matching",
            questions: [
              {
                q: "Câu 1: Ghép thẻ HTML với chức năng đúng:",
                pairs: [
                  { left: "<table>", right: "Tạo bảng" },
                  { left: "<tr>", right: "Tạo dòng trong bảng" },
                  { left: "<caption>", right: "Tạo chú thích cho bảng" },
                  { left: "<td>", right: "Tạo ô trong bảng" }
                ]
              },
              {
                q: "Câu 2: Ghép thẻ tạo danh sách với mô tả đúng:",
                pairs: [
                  { left: "<ul>", right: "Danh sách không thứ tự" },
                  { left: "<ol>", right: "Danh sách có thứ tự" },
                  { left: "<li>", right: "Mục trong danh sách" },
                  { left: "<dl>", right: "Danh sách mô tả" }
                ]
              },
              {
                q: "Câu 3: Ghép các thẻ định dạng văn bản với ý nghĩa:",
                pairs: [
                  { left: "<b>", right: "In đậm văn bản" },
                  { left: "<i>", right: "In nghiêng văn bản" },
                  { left: "<u>", right: "Gạch chân văn bản" },
                  { left: "<mark>", right: "Tô sáng (Highlight)" }
                ]
              }
            ]
          }
        ];

        const CandyBackground = () => {
          const candyColors = [
            "text-red-400", "text-orange-400", "text-yellow-400", 
            "text-lime-400", "text-green-400", "text-emerald-400",
            "text-teal-400", "text-cyan-400", "text-sky-400",
            "text-blue-400", "text-indigo-400", "text-violet-400",
            "text-purple-400", "text-fuchsia-400", "text-pink-400", "text-rose-400"
          ];

          return (
            <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
              {[...Array(50)].map((_, i) => {
                const randomColor = candyColors[Math.floor(Math.random() * candyColors.length)];
                return (
                  <Candy
                    key={i}
                    className={`absolute ${randomColor} opacity-20`}
                    size={Math.random() * 30 + 15}
                    style={{
                      top: `${Math.random() * 100}%`,
                      left: `${Math.random() * 100}%`,
                      transform: `rotate(${Math.random() * 360}deg)`,
                      animation: `pulse ${Math.random() * 3 + 2}s cubic-bezier(0.4, 0, 0.6, 1) infinite`,
                      animationDelay: `${Math.random() * 2}s`
                    }}
                  />
                );
              })}
            </div>
          );
        };

        const shuffleArray = (array) => {
          const newArray = [...array];
          for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
          }
          return newArray;
        };

        const playTickSound = () => {
          try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'triangle'; 
            osc.frequency.setValueAtTime(800, ctx.currentTime);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
            osc.start();
            osc.stop(ctx.currentTime + 0.1);
          } catch (error) {
            console.error("Audio error", error);
          }
        };

        function App() {
          const [currentScreen, setCurrentScreen] = useState('login'); 
          
          const [studentsData, setStudentsData] = useState(INITIAL_STUDENTS);

          // User Info
          const [selectedClass, setSelectedClass] = useState("");
          const [selectedName, setSelectedName] = useState("");

          const [unlockedLevels, setUnlockedLevels] = useState([1]); 
          const [currentLevelId, setCurrentLevelId] = useState(null);
          
          // Game State
          const [currentQuestions, setCurrentQuestions] = useState([]);
          const [questionIndex, setQuestionIndex] = useState(0);
          
          const [score, setScore] = useState(0);
          const [lives, setLives] = useState(3);
          const [timeLeft, setTimeLeft] = useState(0);
          const [isPaused, setIsPaused] = useState(false);
          const [selectedOption, setSelectedOption] = useState(null);
          const [feedback, setFeedback] = useState(null); 
          const [highScores, setHighScores] = useState({});
          const scoreRef = useRef(0);
          const [retryUsed, setRetryUsed] = useState(false); 
          const timerRef = useRef(null);

          // Matching Game State
          const [connections, setConnections] = useState([]); 
          const [activeDrag, setActiveDrag] = useState(null); 
          const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
          const containerRef = useRef(null);
          const leftRefs = useRef({});
          const rightRefs = useRef({});

          // --- LOGIC ---

          const handleLogin = () => {
            if (selectedClass && selectedName) {
              setCurrentScreen('instruction'); // Vào màn hình hướng dẫn trước
            }
          };

          const handleStartGameFlow = () => {
            setCurrentScreen('map'); // Từ hướng dẫn vào thẳng Map
          }

          const handleFinishGame = () => {
            const newStudentsData = { ...studentsData };
            if (selectedClass && selectedName) {
              newStudentsData[selectedClass] = newStudentsData[selectedClass].filter(
                name => name !== selectedName
              );
            }
            setStudentsData(newStudentsData);

            setSelectedName("");
            setSelectedClass("");
            setHighScores({});
            setUnlockedLevels([1]);
            setScore(0);
            setLives(3);
            setCurrentScreen('login');
          };
          
          const startGame = (levelId, isRetry = false) => {
            const level = DATA_LEVELS.find(l => l.id === levelId);
            
            let levelQuestions = [...level.questions];
            levelQuestions = shuffleArray(levelQuestions);

            const processedQuestions = levelQuestions.map((q, qIdx) => {
              if (level.type === 'matching') {
                const pairsWithId = q.pairs.map((p, idx) => ({ ...p, id: `${qIdx}-${idx}` }));
                const leftItems = pairsWithId.map(p => ({ id: p.id, content: p.left }));
                const rightItems = shuffleArray(pairsWithId.map(p => ({ id: p.id, content: p.right })));
                return { ...q, type: 'matching', leftItems, rightItems };
              } else {
                const originalOptions = q.options;
                const correctText = originalOptions[q.correct]; 
                const shuffledOptions = shuffleArray(originalOptions); 
                const newCorrectIndex = shuffledOptions.indexOf(correctText); 
                return { ...q, type: 'multiple-choice', options: shuffledOptions, correct: newCorrectIndex };
              }
            });

            setCurrentQuestions(processedQuestions);
            setCurrentLevelId(levelId);
            setQuestionIndex(0);
            setScore(0);
            scoreRef.current = 0; 
            setLives(3);
            setTimeLeft(level.timePerQuestion);
            setIsPaused(false);
            setSelectedOption(null);
            setFeedback(null);
            setConnections([]);
            if (!isRetry) setRetryUsed(false);
            setCurrentScreen('game');
          };

          const goHome = () => {
            setHighScores({});
            setUnlockedLevels([1]);
            setCurrentScreen('instruction'); // Quay về hướng dẫn thay vì Home cũ
          };

          const goMap = () => setCurrentScreen('map');

          useEffect(() => {
            if (currentScreen === 'game' && !isPaused && timeLeft > 0 && feedback === null) {
              if (timeLeft <= 10) playTickSound();
              timerRef.current = setTimeout(() => {
                setTimeLeft(prev => prev - 1);
              }, 1000);
            } else if (timeLeft === 0 && currentScreen === 'game' && feedback === null) {
              const currentQ = currentQuestions[questionIndex];
              if (currentQ.type === 'matching') {
                checkMatchingAnswer(true); 
              } else {
                handleWrongAnswer();
              }
            }
            return () => clearTimeout(timerRef.current);
          }, [timeLeft, currentScreen, isPaused, feedback]);

          // --- MATCHING GAME LOGIC ---
          const getCoordinates = (element) => {
            if (!containerRef.current || !element) return { x: 0, y: 0 };
            const containerRect = containerRef.current.getBoundingClientRect();
            const elemRect = element.getBoundingClientRect();
            return {
              x: elemRect.left - containerRect.left + elemRect.width / 2,
              y: elemRect.top - containerRect.top + elemRect.height / 2
            };
          };

          const handleDragStart = (id, e) => {
            if (feedback !== null) return;
            if (connections.some(c => c.leftId === id)) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const containerRect = containerRef.current.getBoundingClientRect();
            setMousePos({ x: clientX - containerRect.left, y: clientY - containerRect.top });
            setActiveDrag({ startId: id });
          };

          const handleDragMove = (e) => {
            if (!activeDrag) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            if (containerRef.current) {
              const containerRect = containerRef.current.getBoundingClientRect();
              setMousePos({ x: clientX - containerRect.left, y: clientY - containerRect.top });
            }
          };

          const handleDragEnd = (e) => {
            if (!activeDrag) return;
            const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
            const elements = document.elementsFromPoint(clientX, clientY);
            const rightItem = elements.find(el => el.getAttribute('data-right-id'));
            if (rightItem) {
              const rightId = rightItem.getAttribute('data-right-id');
              if (!connections.some(c => c.rightId === rightId)) {
                const newConnection = { leftId: activeDrag.startId, rightId: rightId };
                const newConnections = [...connections, newConnection];
                setConnections(newConnections);
                const currentQ = currentQuestions[questionIndex];
                if (newConnections.length === currentQ.leftItems.length) {
                  checkMatchingAnswer(false, newConnections);
                }
              }
            }
            setActiveDrag(null);
          };

          const checkMatchingAnswer = (isTimeout, finalConnections = connections) => {
            const currentQ = currentQuestions[questionIndex];
            let isAllCorrect = true;
            if (finalConnections.length < currentQ.leftItems.length) isAllCorrect = false;
            else {
              finalConnections.forEach(conn => {
                if (conn.leftId !== conn.rightId) isAllCorrect = false;
              });
            }
            if (isAllCorrect && !isTimeout) {
              setFeedback('correct');
              setScore(prev => prev + 10);
              scoreRef.current += 10;
              setTimeout(nextQuestion, 1500);
            } else {
              setFeedback('wrong');
              setLives(prev => prev - 1);
              if (lives <= 1) setTimeout(finishGame, 1000);
              else setTimeout(nextQuestion, 2000);
            }
          };

          // --- MULTIPLE CHOICE LOGIC ---
          const handleMCAnswer = (optionIndex) => {
            if (feedback !== null) return;
            const currentQ = currentQuestions[questionIndex];
            setSelectedOption(optionIndex);
            if (optionIndex === currentQ.correct) {
              setFeedback('correct');
              setScore(prev => prev + 10);
              scoreRef.current += 10;
              setTimeout(nextQuestion, 1000);
            } else {
              handleWrongAnswer();
            }
          };

          const handleWrongAnswer = () => {
            setFeedback('wrong');
            setLives(prev => prev - 1);
            if (lives <= 1) setTimeout(finishGame, 1000);
            else setTimeout(nextQuestion, 1500);
          };

          const nextQuestion = () => {
            if (questionIndex < currentQuestions.length - 1) {
              setQuestionIndex(prev => prev + 1);
              const level = DATA_LEVELS.find(l => l.id === currentLevelId);
              setTimeLeft(level.timePerQuestion);
              setSelectedOption(null);
              setFeedback(null);
              setConnections([]);
            } else {
              finishGame();
            }
          };

          const finishGame = () => {
            setHighScores(prev => ({ ...prev, [currentLevelId]: Math.max(prev[currentLevelId] || 0, scoreRef.current) }));
            if (!unlockedLevels.includes(currentLevelId + 1)) {
              setUnlockedLevels([...unlockedLevels, currentLevelId + 1]);
            }
            setCurrentScreen('result');
          };

          // --- RENDER FUNCTIONS ---

          const renderLogin = () => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-sky-50 relative overflow-hidden text-slate-800 p-4">
              {/* Background with multiple colored candies */}
              <CandyBackground />
              
              {/* Main Login Card */}
              <div className="z-10 bg-white/90 backdrop-blur-md p-10 rounded-[3rem] shadow-2xl border-8 border-pink-200 flex flex-col items-center max-w-lg w-full animate-fade-in-up transform transition-all hover:scale-[1.01]">
                
                {/* Title Section */}
                <div className="text-center mb-10 w-full">
                  <h1 className="text-2xl md:text-3xl lg:text-4xl font-black text-rose-600 drop-shadow-sm mb-2 tracking-wide leading-tight">
                    HÀNH TRÌNH<br/>
                    {/* Sử dụng whitespace-nowrap để ép chữ "SĂN KẸO NGỌT" luôn ở trên một dòng */}
                    <span className="text-3xl md:text-4xl lg:text-5xl text-purple-600 inline-block mt-2 whitespace-nowrap">SĂN KẸO NGỌT</span>
                  </h1>
                  <div className="flex justify-center gap-2 mt-4">
                     <Candy className="text-pink-500 animate-bounce" size={32} />
                     <Candy className="text-purple-500 animate-bounce delay-100" size={32} />
                     <Candy className="text-orange-500 animate-bounce delay-200" size={32} />
                  </div>
                </div>

                {/* Form Section */}
                <div className="w-full space-y-6">
                  
                  {/* Biệt đội / Lớp */}
                  <div className="relative group">
                    <div className="relative bg-pink-50 rounded-2xl p-2 transition-all group-hover:bg-pink-100">
                      <div className="absolute left-4 top-1/2 -translate-y-1/2 text-pink-400 pointer-events-none">
                        <School size={28} />
                      </div>
                      <select 
                        className="w-full p-4 pl-14 bg-transparent border-none font-bold text-xl text-slate-700 appearance-none focus:outline-none cursor-pointer"
                        value={selectedClass}
                        onChange={(e) => {
                          setSelectedClass(e.target.value);
                          setSelectedName(""); 
                        }}
                      >
                        <option value="">-- Chọn Biệt Đội --</option>
                        {Object.keys(studentsData).map(cls => (
                          <option key={cls} value={cls}>{cls}</option>
                        ))}
                      </select>
                      <div className="absolute right-4 top-1/2 -translate-y-1/2 text-pink-400 pointer-events-none">
                        <ChevronDown size={24} strokeWidth={3} />
                      </div>
                    </div>
                  </div>

                  {/* Tên Thợ Săn */}
                  <div className="relative group">
                    <div className="relative bg-indigo-50 rounded-2xl p-2 transition-all group-hover:bg-indigo-100">
                      <div className="absolute left-4 top-1/2 -translate-y-1/2 text-indigo-400 pointer-events-none">
                        <Smile size={28} />
                      </div>
                      <select 
                        className="w-full p-4 pl-14 bg-transparent border-none font-bold text-xl text-slate-700 appearance-none focus:outline-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
                        value={selectedName}
                        onChange={(e) => setSelectedName(e.target.value)}
                        disabled={!selectedClass}
                      >
                        <option value="">-- Chọn Tên Thợ Săn --</option>
                        {selectedClass && studentsData[selectedClass].map((name, idx) => (
                          <option key={idx} value={name}>{name}</option>
                        ))}
                      </select>
                      <div className="absolute right-4 top-1/2 -translate-y-1/2 text-indigo-400 pointer-events-none">
                        <ChevronDown size={24} strokeWidth={3} />
                      </div>
                    </div>
                  </div>

                  {/* Start Button */}
                  <button 
                    onClick={handleLogin}
                    disabled={!selectedClass || !selectedName}
                    className="w-full mt-8 py-5 bg-gradient-to-r from-pink-500 to-indigo-600 hover:from-pink-600 hover:to-indigo-700 disabled:from-slate-300 disabled:to-slate-400 disabled:cursor-not-allowed text-white text-2xl font-black rounded-3xl shadow-[0_8px_0_rgba(0,0,0,0.2)] active:shadow-[0_4px_0_rgba(0,0,0,0.2)] active:translate-y-1 transition-all flex items-center justify-center gap-3 uppercase tracking-wider group"
                  >
                    BẮT ĐẦU NGAY <Play size={28} fill="currentColor" className="group-hover:animate-pulse" />
                  </button>

                </div>
              </div>
            </div>
          );

          const renderInstruction = () => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-indigo-50 text-slate-800 p-4 relative overflow-hidden">
              <CandyBackground />
              <div className="z-10 bg-white/90 backdrop-blur-md p-8 rounded-3xl shadow-2xl border-4 border-indigo-200 max-w-2xl w-full animate-fade-in-up">
                <div className="flex items-center justify-center mb-6">
                  <div className="p-4 bg-indigo-100 rounded-full text-indigo-600 shadow-inner">
                    <Info size={48} />
                  </div>
                </div>
                <h2 className="text-3xl font-black text-center mb-2 text-indigo-800 uppercase">NHIỆM VỤ THỢ SĂN</h2>
                <p className="text-center text-slate-600 mb-8 font-medium">
                  Chào mừng thợ săn <span className="text-indigo-600 font-bold">{selectedName}</span>! 
                  <br/>Để giành được kho báu kẹo ngọt, bạn phải vượt qua 3 cửa ải cam go:
                </p>

                <div className="space-y-4 mb-8">
                  <div className="bg-emerald-50 border-l-8 border-emerald-500 p-4 rounded-r-xl shadow-sm flex items-start gap-4">
                    <div className="p-2 bg-white rounded-full text-emerald-600 shadow-sm"><Trees size={24} /></div>
                    <div>
                      <h3 className="font-bold text-emerald-800 text-lg">Cửa ải 1: Khu Rừng Bí Ẩn</h3>
                      <p className="text-sm text-slate-600">Trả lời các câu hỏi trắc nghiệm về kiến thức HTML.</p>
                      <span className="inline-block mt-1 px-2 py-0.5 bg-emerald-200 text-emerald-800 text-xs font-bold rounded">30 giây / câu</span>
                    </div>
                  </div>

                  <div className="bg-blue-50 border-l-8 border-blue-500 p-4 rounded-r-xl shadow-sm flex items-start gap-4">
                    <div className="p-2 bg-white rounded-full text-blue-600 shadow-sm"><Waves size={24} /></div>
                    <div>
                      <h3 className="font-bold text-blue-800 text-lg">Cửa ải 2: Đại Dương Sâu Thẳm</h3>
                      <p className="text-sm text-slate-600">Quyết định Đúng hoặc Sai về liên kết HTML.</p>
                      <span className="inline-block mt-1 px-2 py-0.5 bg-blue-200 text-blue-800 text-xs font-bold rounded">20 giây / câu</span>
                    </div>
                  </div>

                  <div className="bg-rose-50 border-l-8 border-rose-500 p-4 rounded-r-xl shadow-sm flex items-start gap-4">
                    <div className="p-2 bg-white rounded-full text-rose-600 shadow-sm"><Flame size={24} /></div>
                    <div>
                      <h3 className="font-bold text-rose-800 text-lg">Cửa ải 3: Núi Lửa Phun Trào</h3>
                      <p className="text-sm text-slate-600">Kéo thả để ghép nối các thẻ HTML với chức năng.</p>
                      <span className="inline-block mt-1 px-2 py-0.5 bg-rose-200 text-rose-800 text-xs font-bold rounded">15 giây / câu</span>
                    </div>
                  </div>
                </div>

                <button 
                  onClick={handleStartGameFlow}
                  className="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2"
                >
                  ĐÃ HIỂU, LÊN ĐƯỜNG! <ArrowRight />
                </button>
              </div>
            </div>
          );

          const renderHome = () => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-amber-50 relative overflow-hidden text-slate-800">
              <CandyBackground />
              <div className="z-10 bg-white/80 backdrop-blur-sm p-8 rounded-3xl shadow-2xl border-4 border-amber-200 flex flex-col items-center max-w-lg w-full mx-4 relative">
                <h1 className="text-4xl md:text-5xl font-black text-center mb-2 text-amber-800 uppercase tracking-wider mt-4">Hành Trình<br/>Săn Kẹo Ngọt</h1>
                <div className="bg-white/50 px-4 py-2 rounded-lg border border-amber-100 mb-6 text-center">
                  <p className="text-sm text-slate-500 font-bold uppercase">Thợ săn</p>
                  <p className="text-xl font-black text-sky-600">{selectedName}</p>
                  <p className="text-sm font-bold text-slate-400">Biệt đội {selectedClass}</p>
                </div>
                <p className="text-lg text-center mb-8 text-amber-900/70 font-medium">Vượt qua 3 cửa ải, tích lũy điểm số để nhận phần thưởng kẹo ngọt hấp dẫn!</p>
                <button onClick={goMap} className="w-full py-4 bg-orange-500 hover:bg-orange-600 text-white text-xl font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2"><Play fill="currentColor" /> BẮT ĐẦU NGAY</button>
              </div>
            </div>
          );

          // ... (Giữ nguyên các hàm renderMap, renderGame, renderResult, renderVictory)
          // Để tiết kiệm không gian, tôi chỉ liệt kê lại các hàm đã có trong phiên bản trước.
          // Trong file thực tế, hãy đảm bảo copy đầy đủ các hàm này.
          
          return (
            <div className="font-sans antialiased">
              {currentScreen === 'login' && renderLogin()}
              {currentScreen === 'instruction' && renderInstruction()}
              {currentScreen === 'home' && renderHome()}
              {currentScreen === 'map' && renderMap()}
              {currentScreen === 'game' && renderGame()}
              {currentScreen === 'result' && renderResult()}
              {currentScreen === 'victory' && renderVictory()}
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
